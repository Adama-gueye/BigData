{
  "version": "1",
  "metadata": {
    "marimo_version": "0.20.1"
  },
  "cells": [
    {
      "id": "RGSE",
      "code_hash": "8bb44c7f817ccab1ca6fb6fd377a08e2",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"silver-orders-postgresql\">Silver \u2013 Orders (PostgreSQL)</h3></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "emfo",
      "code_hash": "58227dcee15367b20c3464351e7dbc28",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"silver-events-mongodb\">Silver \u2013 Events (MongoDB)</h3></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "nWHF",
      "code_hash": "52ad23edd4b757e0c81619e568b7d551",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"silver-exchange-rates-api\">Silver \u2013 Exchange Rates (API)</h3></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "ZHCJ",
      "code_hash": "fee7cc1de28ba5fa7ab2d560e0408945",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"silver-files-csv-ventes\">SILVER \u2013 FILES (CSV ventes)</h3></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "qnkX",
      "code_hash": "acb56133f26205d1cd6b4ee734177121",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"gold-chiffre-daffaires-par-statut\">Gold \u2013 Chiffre d\u2019affaires par statut</h3></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Vxnm",
      "code_hash": "6f7bde4b4b28d6f378276b8866f9221a",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"gold-top-clients\">Gold \u2013 Top clients</h3></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "ulZA",
      "code_hash": "a095ef69006c404b49bbcc8736e0bcd2",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"gold-events-par-type\">Gold \u2013 Events par type</h3></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Pvdt",
      "code_hash": "2424ac3bd62dfa2dd06f4481b50a8d4c",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"gold-chiffre-daffaires-issu-des-fichiers\">Gold \u2013 Chiffre d\u2019affaires issu des fichiers</h3></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "aLJB",
      "code_hash": "5dec4dc929403d4b771f73dbc36066da",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"gold-top-clients-fichiers\">Gold \u2013 Top clients (fichiers)</h3></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Hbol",
      "code_hash": "c0c664198a6e57908c13646beec8dee9",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "\n            <div>\n                <p><b>SparkSession - in-memory</b></p>\n                \n        <div>\n            <p><b>SparkContext</b></p>\n\n            <p><a href=\"http://be246240c110:4040\">Spark UI</a></p>\n\n            <dl>\n              <dt>Version</dt>\n                <dd><code>v3.5.0</code></dd>\n              <dt>Master</dt>\n                <dd><code>local[*]</code></dd>\n              <dt>AppName</dt>\n                <dd><code>BronzeIngestion</code></dd>\n            </dl>\n        </div>\n        \n            </div>\n        "
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": ":: loading settings :: url = jar:file:/usr/local/lib/python3.11/site-packages/pyspark/jars/ivy-2.5.1.jar!/org/apache/ivy/core/settings/ivysettings.xml\n",
          "mimetype": "text/plain"
        },
        {
          "type": "stream",
          "name": "stderr",
          "text": "Ivy Default Cache set to: /root/.ivy2/cache\nThe jars for the packages stored in: /root/.ivy2/jars\norg.postgresql#postgresql added as a dependency\norg.apache.hadoop#hadoop-aws added as a dependency\ncom.amazonaws#aws-java-sdk-bundle added as a dependency\norg.mongodb.spark#mongo-spark-connector_2.12 added as a dependency\n:: resolving dependencies :: org.apache.spark#spark-submit-parent-2c7d4486-3964-499b-9cc2-f912bce24db5;1.0\n\tconfs: [default]\n\tfound org.postgresql#postgresql;42.7.3 in central\n\tfound org.checkerframework#checker-qual;3.42.0 in central\n\tfound org.apache.hadoop#hadoop-aws;3.3.4 in central\n\tfound org.wildfly.openssl#wildfly-openssl;1.0.7.Final in central\n\tfound com.amazonaws#aws-java-sdk-bundle;1.12.540 in central\n\tfound org.mongodb.spark#mongo-spark-connector_2.12;3.0.1 in central\n\tfound org.mongodb#mongodb-driver-sync;4.0.5 in central\n\tfound org.mongodb#bson;4.0.5 in central\n\tfound org.mongodb#mongodb-driver-core;4.0.5 in central\ndownloading https://repo1.maven.org/maven2/org/postgresql/postgresql/42.7.3/postgresql-42.7.3.jar ...\n\t[SUCCESSFUL ] org.postgresql#postgresql;42.7.3!postgresql.jar (123ms)\ndownloading https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-aws/3.3.4/hadoop-aws-3.3.4.jar ...\n\t[SUCCESSFUL ] org.apache.hadoop#hadoop-aws;3.3.4!hadoop-aws.jar (240ms)\ndownloading https://repo1.maven.org/maven2/com/amazonaws/aws-java-sdk-bundle/1.12.540/aws-java-sdk-bundle-1.12.540.jar ...\n\t[SUCCESSFUL ] com.amazonaws#aws-java-sdk-bundle;1.12.540!aws-java-sdk-bundle.jar (104889ms)\ndownloading https://repo1.maven.org/maven2/org/mongodb/spark/mongo-spark-connector_2.12/3.0.1/mongo-spark-connector_2.12-3.0.1.jar ...\n\t[SUCCESSFUL ] org.mongodb.spark#mongo-spark-connector_2.12;3.0.1!mongo-spark-connector_2.12.jar (158ms)\ndownloading https://repo1.maven.org/maven2/org/checkerframework/checker-qual/3.42.0/checker-qual-3.42.0.jar ...\n\t[SUCCESSFUL ] org.checkerframework#checker-qual;3.42.0!checker-qual.jar (76ms)\ndownloading https://repo1.maven.org/maven2/org/wildfly/openssl/wildfly-openssl/1.0.7.Final/wildfly-openssl-1.0.7.Final.jar ...\n\t[SUCCESSFUL ] org.wildfly.openssl#wildfly-openssl;1.0.7.Final!wildfly-openssl.jar (114ms)\ndownloading https://repo1.maven.org/maven2/org/mongodb/mongodb-driver-sync/4.0.5/mongodb-driver-sync-4.0.5.jar ...\n\t[SUCCESSFUL ] org.mongodb#mongodb-driver-sync;4.0.5!mongodb-driver-sync.jar (57ms)\ndownloading https://repo1.maven.org/maven2/org/mongodb/bson/4.0.5/bson-4.0.5.jar ...\n\t[SUCCESSFUL ] org.mongodb#bson;4.0.5!bson.jar (117ms)\ndownloading https://repo1.maven.org/maven2/org/mongodb/mongodb-driver-core/4.0.5/mongodb-driver-core-4.0.5.jar ...\n\t[SUCCESSFUL ] org.mongodb#mongodb-driver-core;4.0.5!mongodb-driver-core.jar (430ms)\n:: resolution report :: resolve 7943ms :: artifacts dl 106220ms\n\t:: modules in use:\n\tcom.amazonaws#aws-java-sdk-bundle;1.12.540 from central in [default]\n\torg.apache.hadoop#hadoop-aws;3.3.4 from central in [default]\n\torg.checkerframework#checker-qual;3.42.0 from central in [default]\n\torg.mongodb#bson;4.0.5 from central in [default]\n\torg.mongodb#mongodb-driver-core;4.0.5 from central in [default]\n\torg.mongodb#mongodb-driver-sync;4.0.5 from central in [default]\n\torg.mongodb.spark#mongo-spark-connector_2.12;3.0.1 from central in [default]\n\torg.postgresql#postgresql;42.7.3 from central in [default]\n\torg.wildfly.openssl#wildfly-openssl;1.0.7.Final from central in [default]\n\t:: evicted modules:\n\tcom.amazonaws#aws-java-sdk-bundle;1.12.262 by [com.amazonaws#aws-java-sdk-bundle;1.12.540] in [default]\n\t---------------------------------------------------------------------\n\t|                  |            modules            ||   artifacts   |\n\t|       conf       | number| search|dwnlded|evicted|| number|dwnlded|\n\t---------------------------------------------------------------------\n\t|      default     |   10  |   9   |   9   |   1   ||   9   |   9   |\n\t---------------------------------------------------------------------\n:: retrieving :: org.apache.spark#spark-submit-parent-2c7d4486-3964-499b-9cc2-f912bce24db5\n\tconfs: [default]\n\t9 artifacts copied, 0 already retrieved (337379kB/640ms)\n26/02/25 20:45:52 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\nSetting default log level to \"WARN\".\nTo adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "MJUe",
      "code_hash": "20ef60dc488f8d50378efac6f924ef3e",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "An error occurred while calling o44.load.\n: org.postgresql.util.PSQLException: ERROR: relation \"orders\" does not exist\n  Position: 15\n\tat org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)\n\tat org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)\n\tat org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)\n\tat org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)\n\tat org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)\n\tat org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:194)\n\tat org.postgresql.jdbc.PgPreparedStatement.executeQuery(PgPreparedStatement.java:137)\n\tat org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD$.getQueryOutputSchema(JDBCRDD.scala:68)\n\tat org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD$.resolveTable(JDBCRDD.scala:58)\n\tat org.apache.spark.sql.execution.datasources.jdbc.JDBCRelation$.getSchema(JDBCRelation.scala:241)\n\tat org.apache.spark.sql.execution.datasources.jdbc.JdbcRelationProvider.createRelation(JdbcRelationProvider.scala:37)\n\tat org.apache.spark.sql.execution.datasources.DataSource.resolveRelation(DataSource.scala:346)\n\tat org.apache.spark.sql.DataFrameReader.loadV1Source(DataFrameReader.scala:229)\n\tat org.apache.spark.sql.DataFrameReader.$anonfun$load$2(DataFrameReader.scala:211)\n\tat scala.Option.getOrElse(Option.scala:189)\n\tat org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:211)\n\tat org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:172)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:75)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:52)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:580)\n\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)\n\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:374)\n\tat py4j.Gateway.invoke(Gateway.java:282)\n\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\n\tat py4j.commands.CallCommand.execute(CallCommand.java:79)\n\tat py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)\n\tat py4j.ClientServerConnection.run(ClientServerConnection.java:106)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n",
          "traceback": []
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/tmp/marimo_21/__marimo__cell_MJUe_.py&quot;</span>, line <span class=\"m\">9</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"o\">.</span><span class=\"n\">load</span><span class=\"p\">()</span>\n<span class=\"w\">     </span><span class=\"pm\">^^^^^^</span>\n  File <span class=\"nb\">&quot;/usr/local/lib/python3.11/site-packages/pyspark/sql/readwriter.py&quot;</span>, line <span class=\"m\">314</span>, in <span class=\"n\">load</span>\n<span class=\"w\">    </span><span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_df</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_jreader</span><span class=\"o\">.</span><span class=\"n\">load</span><span class=\"p\">())</span>\n<span class=\"w\">                    </span><span class=\"pm\">^^^^^^^^^^^^^^^^^^^^</span>\n  File <span class=\"nb\">&quot;/usr/local/lib/python3.11/site-packages/py4j/java_gateway.py&quot;</span>, line <span class=\"m\">1322</span>, in <span class=\"n\">__call__</span>\n<span class=\"w\">    </span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"n\">get_return_value</span><span class=\"p\">(</span>\n<span class=\"w\">                   </span><span class=\"pm\">^^^^^^^^^^^^^^^^^</span>\n  File <span class=\"nb\">&quot;/usr/local/lib/python3.11/site-packages/pyspark/errors/exceptions/captured.py&quot;</span>, line <span class=\"m\">179</span>, in <span class=\"n\">deco</span>\n<span class=\"w\">    </span><span class=\"k\">return</span> <span class=\"n\">f</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kw</span><span class=\"p\">)</span>\n<span class=\"w\">           </span><span class=\"pm\">^^^^^^^^^^^</span>\n  File <span class=\"nb\">&quot;/usr/local/lib/python3.11/site-packages/py4j/protocol.py&quot;</span>, line <span class=\"m\">326</span>, in <span class=\"n\">get_return_value</span>\n<span class=\"w\">    </span><span class=\"k\">raise</span> <span class=\"n\">Py4JJavaError</span><span class=\"p\">(</span>\n<span class=\"gr\">py4j.protocol.Py4JJavaError</span>: <span class=\"n\">An error occurred while calling o44.load.</span>\n<span class=\"x\">: org.postgresql.util.PSQLException: ERROR: relation &quot;orders&quot; does not exist</span>\n<span class=\"x\">  Position: 15</span>\n<span class=\"x\">\tat org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2725)</span>\n<span class=\"x\">\tat org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2412)</span>\n<span class=\"x\">\tat org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:371)</span>\n<span class=\"x\">\tat org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:502)</span>\n<span class=\"x\">\tat org.postgresql.jdbc.PgStatement.execute(PgStatement.java:419)</span>\n<span class=\"x\">\tat org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:194)</span>\n<span class=\"x\">\tat org.postgresql.jdbc.PgPreparedStatement.executeQuery(PgPreparedStatement.java:137)</span>\n<span class=\"x\">\tat org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD$.getQueryOutputSchema(JDBCRDD.scala:68)</span>\n<span class=\"x\">\tat org.apache.spark.sql.execution.datasources.jdbc.JDBCRDD$.resolveTable(JDBCRDD.scala:58)</span>\n<span class=\"x\">\tat org.apache.spark.sql.execution.datasources.jdbc.JDBCRelation$.getSchema(JDBCRelation.scala:241)</span>\n<span class=\"x\">\tat org.apache.spark.sql.execution.datasources.jdbc.JdbcRelationProvider.createRelation(JdbcRelationProvider.scala:37)</span>\n<span class=\"x\">\tat org.apache.spark.sql.execution.datasources.DataSource.resolveRelation(DataSource.scala:346)</span>\n<span class=\"x\">\tat org.apache.spark.sql.DataFrameReader.loadV1Source(DataFrameReader.scala:229)</span>\n<span class=\"x\">\tat org.apache.spark.sql.DataFrameReader.$anonfun$load$2(DataFrameReader.scala:211)</span>\n<span class=\"x\">\tat scala.Option.getOrElse(Option.scala:189)</span>\n<span class=\"x\">\tat org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:211)</span>\n<span class=\"x\">\tat org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:172)</span>\n<span class=\"x\">\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span>\n<span class=\"x\">\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:75)</span>\n<span class=\"x\">\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:52)</span>\n<span class=\"x\">\tat java.base/java.lang.reflect.Method.invoke(Method.java:580)</span>\n<span class=\"x\">\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)</span>\n<span class=\"x\">\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:374)</span>\n<span class=\"x\">\tat py4j.Gateway.invoke(Gateway.java:282)</span>\n<span class=\"x\">\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)</span>\n<span class=\"x\">\tat py4j.commands.CallCommand.execute(CallCommand.java:79)</span>\n<span class=\"x\">\tat py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)</span>\n<span class=\"x\">\tat py4j.ClientServerConnection.run(ClientServerConnection.java:106)</span>\n<span class=\"x\">\tat java.base/java.lang.Thread.run(Thread.java:1583)</span>\n</pre></div>\n</span>",
          "mimetype": "application/vnd.marimo+traceback"
        }
      ]
    },
    {
      "id": "vblA",
      "code_hash": "643b23b4e08f68e4543efd45b025ff08",
      "outputs": [],
      "console": []
    },
    {
      "id": "bkHC",
      "code_hash": "0f530d1ff2cef5c78612b0ff9a317981",
      "outputs": [],
      "console": []
    },
    {
      "id": "lEQa",
      "code_hash": "7f4a17c749c32133a2d5633cad7e9eca",
      "outputs": [],
      "console": []
    },
    {
      "id": "PKri",
      "code_hash": "71eafc5979ded6885e5fb696364807a0",
      "outputs": [],
      "console": []
    },
    {
      "id": "Xref",
      "code_hash": "112d5800380a2457d224cd66ee54bb1a",
      "outputs": [],
      "console": []
    },
    {
      "id": "SFPL",
      "code_hash": "48fdf7d1a9e820ec1cace5d8e8d0697c",
      "outputs": [],
      "console": []
    },
    {
      "id": "BYtC",
      "code_hash": "531673cc57bb5ca334b32fbe0df7330a",
      "outputs": [],
      "console": []
    },
    {
      "id": "Kclp",
      "code_hash": "5d82ff19c5faf0550ff1a5fd426e9b1b",
      "outputs": [],
      "console": []
    },
    {
      "id": "Hstk",
      "code_hash": "5864e393d9508a6f28f7f1ff93796572",
      "outputs": [],
      "console": []
    },
    {
      "id": "iLit",
      "code_hash": "214f8a3cd74d089df38ec0fcb29333ac",
      "outputs": [],
      "console": []
    },
    {
      "id": "ROlb",
      "code_hash": "d92d1c7017312a82a13009a943e6defe",
      "outputs": [],
      "console": []
    },
    {
      "id": "TqIu",
      "code_hash": "cdd8805b617d56ba76c408a8eb6b842c",
      "outputs": [],
      "console": []
    },
    {
      "id": "DnEU",
      "code_hash": "17c1391ec820eba7b61d2e9027968b1f",
      "outputs": [],
      "console": []
    },
    {
      "id": "ecfG",
      "code_hash": "60ced47d519e4b81ef46bee9f8bfc2c6",
      "outputs": [],
      "console": []
    },
    {
      "id": "ZBYS",
      "code_hash": "b5bc874bc02b6022d6cb61bad41d3c74",
      "outputs": [],
      "console": []
    },
    {
      "id": "nHfw",
      "code_hash": "a6a6825d02f530ee6abb1797ad6113eb",
      "outputs": [],
      "console": []
    },
    {
      "id": "xXTn",
      "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e",
      "outputs": [],
      "console": []
    }
  ]
}